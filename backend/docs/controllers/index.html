<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1 id="%F0%9F%8C%8A-aqua-stark-backend">üåä Aqua Stark Backend</h1>
<p>Backend API para el juego on-chain de mascotas acu√°ticas Aqua Stark. Maneja estados din√°micos off-chain mientras mantiene la propiedad real en Starknet.</p>
<h2 id="%F0%9F%8F%97%EF%B8%8F-arquitectura">üèóÔ∏è Arquitectura</h2>
<h3 id="on-chain-(starknet%2Fdojo)"><strong>On-chain (Starknet/Dojo)</strong></h3>
<ul>
<li><strong>Propiedad real</strong> de activos (NFTs)</li>
<li><strong>Identificadores √∫nicos</strong> (player_id, fish_id, aquarium_id, decoration_id)</li>
<li><strong>Relaciones de propiedad</strong> (qui√©n posee qu√©)</li>
<li><strong>Datos gen√©ticos</strong> de peces</li>
<li><strong>Econom√≠a</strong> (tokens, precios)</li>
</ul>
<h3 id="off-chain-(supabase-%2B-redis)"><strong>Off-chain (Supabase + Redis)</strong></h3>
<ul>
<li><strong>Estados din√°micos</strong> (felicidad, hambre, salud)</li>
<li><strong>Configuraciones</strong> de usuario</li>
<li><strong>Estad√≠sticas</strong> de gameplay</li>
<li><strong>Sesiones</strong> de minijuegos</li>
<li><strong>Cache</strong> para performance</li>
</ul>
<h2 id="%F0%9F%9A%80-setup-para-contribuidores">üöÄ Setup para Contribuidores</h2>
<h3 id="1.-prerrequisitos">1. Prerrequisitos</h3>
<pre class="prettyprint source lang-bash"><code># Node.js 18+ y pnpm
node --version
pnpm --version

# Supabase CLI
pnpm add -g supabase
</code></pre>
<h3 id="2.-configurar-supabase">2. Configurar Supabase</h3>
<h4 id="opci%C3%B3n-a%3A-usar-supabase-cloud-(recomendado)">Opci√≥n A: Usar Supabase Cloud (Recomendado)</h4>
<ol>
<li>Ve a <a href="https://supabase.com">supabase.com</a></li>
<li>Crea una nueva cuenta/proyecto</li>
<li>Guarda las credenciales:
<ul>
<li><strong>Project URL</strong>: <code>https://your-project-ref.supabase.co</code></li>
<li><strong>Anon Key</strong>: <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></li>
<li><strong>Service Role Key</strong>: <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></li>
</ul>
</li>
</ol>
<h4 id="opci%C3%B3n-b%3A-supabase-local-(docker)">Opci√≥n B: Supabase Local (Docker)</h4>
<pre class="prettyprint source lang-bash"><code># Instalar Supabase CLI
pnpm add -g supabase

# Inicializar proyecto local
supabase init

# Iniciar servicios locales
supabase start

# Las credenciales aparecer√°n en la terminal
</code></pre>
<h3 id="3.-configurar-redis">3. Configurar Redis</h3>
<h4 id="opci%C3%B3n-a%3A-upstash-(recomendado)">Opci√≥n A: Upstash (Recomendado)</h4>
<ol>
<li>Ve a <a href="https://upstash.com">upstash.com</a></li>
<li>Crea una nueva base de datos Redis</li>
<li>Copia la URL de conexi√≥n</li>
</ol>
<h4 id="opci%C3%B3n-b%3A-redis-local">Opci√≥n B: Redis Local</h4>
<pre class="prettyprint source lang-bash"><code># Docker
docker run -d --name redis -p 6379:6379 redis:alpine

# O instalaci√≥n local
# brew install redis (macOS)
# sudo apt install redis-server (Ubuntu)
</code></pre>
<h3 id="4.-configurar-variables-de-entorno">4. Configurar Variables de Entorno</h3>
<p>Copia <code>.env.example</code> a <code>.env</code>:</p>
<pre class="prettyprint source lang-bash"><code>cp .env.example .env
</code></pre>
<p>Edita <code>.env</code> con tus credenciales:</p>
<pre class="prettyprint source lang-env"><code># Supabase Configuration
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Server Configuration
PORT=3001
NODE_ENV=development

# Redis Configuration
REDIS_URL=redis://default:your-password@your-project.upstash.io:6379

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-here

# Game Configuration
GAME_UPDATE_INTERVAL=5000
HAPPINESS_DECAY_RATE=0.1
</code></pre>
<h3 id="5.-instalar-dependencias">5. Instalar Dependencias</h3>
<pre class="prettyprint source lang-bash"><code>cd backend
pnpm install
</code></pre>
<h3 id="6.-aplicar-migraciones-de-base-de-datos">6. Aplicar Migraciones de Base de Datos</h3>
<h4 id="conectar-proyecto-supabase">Conectar Proyecto Supabase</h4>
<pre class="prettyprint source lang-bash"><code># Login a Supabase
supabase login

# Vincular proyecto (usa las credenciales de tu proyecto)
supabase link --project-ref your-project-ref

# Te pedir√° la database password (est√° en Project Settings > Database)
</code></pre>
<h4 id="aplicar-migraciones">Aplicar Migraciones</h4>
<pre class="prettyprint source lang-bash"><code># Aplicar todas las migraciones
npx supabase db push

# Verificar estado
npx supabase db diff

# Si necesitas resetear la BD
npx supabase db reset
</code></pre>
<h3 id="7.-ejecutar-el-servidor">7. Ejecutar el Servidor</h3>
<pre class="prettyprint source lang-bash"><code># Desarrollo
pnpm dev

# Producci√≥n
pnpm start

# Build
pnpm build
</code></pre>
<h2 id="%F0%9F%93%8A-estructura-de-base-de-datos">üìä Estructura de Base de Datos</h2>
<h3 id="tablas-principales">Tablas Principales</h3>
<h4 id="players"><code>players</code></h4>
<ul>
<li><code>player_id</code> (PK) - ID on-chain del jugador</li>
<li><code>wallet_address</code> - Direcci√≥n de wallet</li>
<li><code>username</code> - Nombre de usuario</li>
<li><code>level</code>, <code>experience_current</code>, <code>experience_total</code></li>
<li><code>currency</code> - Moneda off-chain</li>
<li><code>stats</code> - Estad√≠sticas de juego</li>
</ul>
<h4 id="fish_states"><code>fish_states</code></h4>
<ul>
<li><code>fish_id</code> (PK) - ID on-chain del pez</li>
<li><code>player_id</code> (FK) - Referencia al jugador</li>
<li><code>happiness_level</code>, <code>hunger_level</code>, <code>health</code></li>
<li><code>mood</code> - Estado emocional</li>
<li><code>last_fed_timestamp</code>, <code>last_played_timestamp</code></li>
</ul>
<h4 id="aquarium_states"><code>aquarium_states</code></h4>
<ul>
<li><code>aquarium_id</code> (PK) - ID on-chain del acuario</li>
<li><code>player_id</code> (FK) - Referencia al jugador</li>
<li><code>water_temperature</code>, <code>lighting_level</code>, <code>pollution_level</code></li>
<li><code>background_music_playing</code>, <code>current_theme_id</code></li>
</ul>
<h4 id="decoration_states"><code>decoration_states</code></h4>
<ul>
<li><code>decoration_id</code> (PK) - ID on-chain de la decoraci√≥n</li>
<li><code>player_id</code> (FK) - Referencia al jugador</li>
<li><code>aquarium_id</code> (FK) - Acuario donde est√° colocada</li>
<li><code>position_x</code>, <code>position_y</code>, <code>rotation_degrees</code></li>
</ul>
<h2 id="%F0%9F%94%A7-comandos-%C3%BAtiles">üîß Comandos √ötiles</h2>
<h3 id="base-de-datos">Base de Datos</h3>
<pre class="prettyprint source lang-bash"><code># Ver migraciones aplicadas
npx supabase migration list

# Crear nueva migraci√≥n
npx supabase migration new nombre_migracion

# Revertir √∫ltima migraci√≥n
npx supabase db reset

# Ver diferencias
npx supabase db diff
</code></pre>
<h3 id="desarrollo">Desarrollo</h3>
<pre class="prettyprint source lang-bash"><code># Ejecutar tests
pnpm test

# Linting
pnpm lint

# Formatear c√≥digo
pnpm format

# Ver logs en tiempo real
pnpm dev --watch
</code></pre>
<h3 id="redis">Redis</h3>
<pre class="prettyprint source lang-bash"><code># Conectar a Redis CLI
redis-cli -u your-redis-url

# Ver claves
KEYS *

# Ver valor espec√≠fico
GET fish:happiness:fish-123
</code></pre>
<h2 id="%F0%9F%8C%90-endpoints-api">üåê Endpoints API</h2>
<h3 id="health-check">Health Check</h3>
<pre class="prettyprint source"><code>GET /health
</code></pre>
<h3 id="api-base">API Base</h3>
<pre class="prettyprint source"><code>GET /api/v1
</code></pre>
<h3 id="fish-management">Fish Management</h3>
<pre class="prettyprint source"><code>GET    /api/v1/fish/:fishId/state
PUT    /api/v1/fish/:fishId/happiness
POST   /api/v1/fish/:fishId/feed
GET    /api/v1/fish/player/:playerId
</code></pre>
<h3 id="minigames">Minigames</h3>
<pre class="prettyprint source"><code>POST   /api/v1/minigames/start
PUT    /api/v1/minigames/:sessionId/score
GET    /api/v1/minigames/leaderboard
</code></pre>
<h3 id="websocket">WebSocket</h3>
<pre class="prettyprint source"><code>WS /ws
</code></pre>
<h2 id="%EF%BF%BD-controllers-documentation">ÔøΩ Controllers Documentation</h2>
<p>The backend uses a modular controller architecture with comprehensive JSDoc documentation. All controllers follow consistent patterns for request/response handling and error management.</p>
<h3 id="available-controllers">Available Controllers</h3>
<h4 id="playercontroller-(src%2Fcontrollers%2Fplayercontroller.js)"><strong>PlayerController</strong> (<code>src/controllers/playerController.js</code>)</h4>
<p>Handles player-related operations including profile management, experience tracking, and preferences.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>getPlayerProfile()</code> - Get authenticated player's profile</li>
<li><code>getPlayerByWallet()</code> - Get player by wallet address (public)</li>
<li><code>createPlayer()</code> - Create new player account (public)</li>
<li><code>updatePlayerExperience()</code> - Update player XP</li>
<li><code>updatePlayerCurrency()</code> - Update player currency balance</li>
<li><code>updatePlayerStats()</code> - Update player statistics</li>
<li><code>getPlayerPreferences()</code> - Get player preferences</li>
<li><code>updatePlayerPreferences()</code> - Update player preferences</li>
<li><code>getPlayerDashboard()</code> - Get comprehensive dashboard data</li>
</ul>
<h4 id="fishcontroller-(src%2Fcontrollers%2Ffishcontroller.js)"><strong>FishController</strong> (<code>src/controllers/fishController.js</code>)</h4>
<p>Manages fish-related operations including state management, feeding, and breeding.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>getFishState()</code> - Get current fish state</li>
<li><code>updateFishHappiness()</code> - Update fish happiness level</li>
<li><code>feedFish()</code> - Feed fish with specified food type</li>
<li><code>getFishStats()</code> - Get detailed fish statistics</li>
<li><code>getPlayerFish()</code> - Get all fish for a player</li>
<li><code>breedFish()</code> - Breed fish (placeholder for future implementation)</li>
</ul>
<h4 id="decorationcontroller-(src%2Fcontrollers%2Fdecorationcontroller.js)"><strong>DecorationController</strong> (<code>src/controllers/decorationController.js</code>)</h4>
<p>Handles aquarium decoration operations including placement, positioning, and management.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>getDecorationState()</code> - Get decoration state</li>
<li><code>createDecorationState()</code> - Create new decoration state</li>
<li><code>getPlayerDecorations()</code> - Get all player decorations</li>
<li><code>getAquariumDecorations()</code> - Get decorations in specific aquarium</li>
<li><code>placeDecoration()</code> - Place decoration in aquarium</li>
<li><code>removeDecoration()</code> - Remove decoration from aquarium</li>
<li><code>updateDecorationPosition()</code> - Update decoration position/rotation</li>
<li><code>toggleDecorationVisibility()</code> - Toggle decoration visibility</li>
<li><code>moveDecoration()</code> - Move decoration between aquariums</li>
<li><code>bulkUpdatePositions()</code> - Bulk update multiple decoration positions</li>
</ul>
<h4 id="minigamecontroller-(src%2Fcontrollers%2Fminigamecontroller.js)"><strong>MinigameController</strong> (<code>src/controllers/minigameController.js</code>)</h4>
<p>Manages minigame sessions, scoring, leaderboards, and achievements.</p>
<p><strong>Supported Game Types:</strong></p>
<ul>
<li><code>flappy_fish</code> - Navigate fish through obstacles</li>
<li><code>angry_fish</code> - Launch fish to hit targets</li>
<li><code>fish_racing</code> - Race fish against others</li>
<li><code>bubble_pop</code> - Pop bubbles to earn points</li>
<li><code>fish_memory</code> - Match fish pairs in memory game</li>
</ul>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>createGameSession()</code> - Create new game session</li>
<li><code>endGameSession()</code> - End session with final score</li>
<li><code>getPlayerStats()</code> - Get player statistics</li>
<li><code>getGameLeaderboard()</code> - Get leaderboard for specific game</li>
<li><code>getGlobalLeaderboard()</code> - Get global leaderboard</li>
<li><code>awardBonusXP()</code> - Award bonus XP for achievements</li>
<li><code>getGameTypes()</code> - Get available game types</li>
</ul>
<h3 id="controller-exports">Controller Exports</h3>
<p>All controllers are exported through <code>src/controllers/index.js</code>:</p>
<pre class="prettyprint source lang-javascript"><code>import { controllers } from './src/controllers/index.js';
// or
import { PlayerController, FishController } from './src/controllers/index.js';
</code></pre>
<h3 id="documentation-generation">Documentation Generation</h3>
<p>To generate HTML documentation from JSDoc comments:</p>
<pre class="prettyprint source lang-bash"><code># Generate documentation
npm run docs

# Validate documentation quality
npm run docs:validate

# Generate and serve documentation locally
npm run docs:auto

# Serve existing documentation
npm run docs:serve
</code></pre>
<h3 id="automatic-documentation">Automatic Documentation</h3>
<p>The project includes automatic documentation validation and generation:</p>
<ul>
<li><strong>Pre-commit hooks</strong>: Automatically validate documentation on commits</li>
<li><strong>CI/CD Pipeline</strong>: GitHub Actions workflow generates docs on pushes to main</li>
<li><strong>Lint-staged</strong>: Validates controller files before commits</li>
<li><strong>GitHub Pages</strong>: Documentation is automatically deployed</li>
</ul>
<h3 id="documentation-standards">Documentation Standards</h3>
<p>All controller methods must include:</p>
<ul>
<li>Class-level JSDoc with <code>@class</code> tag</li>
<li>Method-level JSDoc with <code>@static</code>, <code>@async</code> tags</li>
<li><code>@param</code> tags for all parameters</li>
<li><code>@returns</code> tag describing return value</li>
<li><code>@example</code> for complex methods</li>
<li>Consistent error/success response patterns</li>
</ul>
<h3 id="response-format">Response Format</h3>
<p>All controllers follow a consistent response format:</p>
<p><strong>Success Response:</strong></p>
<pre class="prettyprint source lang-json"><code>{
  &quot;success&quot;: true,
  &quot;data&quot;: { /* result data */ },
  &quot;message&quot;: &quot;Optional success message&quot;
}
</code></pre>
<p><strong>Error Response:</strong></p>
<pre class="prettyprint source lang-json"><code>{
  &quot;error&quot;: &quot;Error message description&quot;
}
</code></pre>
<h3 id="authentication-%26-authorization">Authentication &amp; Authorization</h3>
<ul>
<li><strong>Public endpoints</strong>: No authentication required (marked in JSDoc)</li>
<li><strong>Protected endpoints</strong>: Require JWT token with <code>walletAddress</code></li>
<li><strong>Ownership validation</strong>: Controllers validate resource ownership</li>
<li><strong>Middleware integration</strong>: Uses ownership middleware for pre-validation</li>
</ul>
<h2 id="%EF%BF%BD%F0%9F%94%90-autenticaci%C3%B3n">ÔøΩüîê Autenticaci√≥n</h2>
<p>El backend usa JWT para autenticaci√≥n basada en wallet:</p>
<pre class="prettyprint source lang-javascript"><code>// Ejemplo de uso
const token = jwt.sign({ walletAddress: '0x123...' }, JWT_SECRET);
</code></pre>
<h2 id="%F0%9F%93%88-monitoreo">üìà Monitoreo</h2>
<h3 id="logs">Logs</h3>
<ul>
<li><strong>Morgan</strong> para logging HTTP</li>
<li><strong>Console</strong> para errores y eventos importantes</li>
<li><strong>Supabase</strong> para logs de base de datos</li>
</ul>
<h3 id="m%C3%A9tricas">M√©tricas</h3>
<ul>
<li><strong>Health check</strong> en <code>/health</code></li>
<li><strong>Uptime</strong> y estad√≠sticas del servidor</li>
<li><strong>Redis</strong> para m√©tricas de cache</li>
</ul>
<h2 id="%F0%9F%90%9B-troubleshooting">üêõ Troubleshooting</h2>
<h3 id="error-de-conexi%C3%B3n-a-supabase">Error de Conexi√≥n a Supabase</h3>
<pre class="prettyprint source lang-bash"><code># Verificar credenciales
echo $SUPABASE_URL
echo $SUPABASE_ANON_KEY

# Re-vincular proyecto
supabase link --project-ref your-project-ref
</code></pre>
<h3 id="error-de-redis">Error de Redis</h3>
<pre class="prettyprint source lang-bash"><code># Verificar URL
echo $REDIS_URL

# Probar conexi√≥n
redis-cli -u $REDIS_URL ping
</code></pre>
<h3 id="puerto-en-uso">Puerto en Uso</h3>
<pre class="prettyprint source lang-bash"><code># Cambiar puerto en .env
PORT=3002

# O matar proceso
lsof -ti:3001 | xargs kill -9
</code></pre>
<h2 id="%F0%9F%A4%9D-contribuir">ü§ù Contribuir</h2>
<ol>
<li><strong>Fork</strong> el repositorio</li>
<li><strong>Crea</strong> una rama para tu feature</li>
<li><strong>Configura</strong> tu entorno local</li>
<li><strong>Desarrolla</strong> y <strong>testea</strong></li>
<li><strong>Commit</strong> con mensajes descriptivos</li>
<li><strong>Push</strong> y crea un <strong>Pull Request</strong></li>
</ol>
<h3 id="convenciones-de-c%C3%B3digo">Convenciones de C√≥digo</h3>
<ul>
<li><strong>ESLint</strong> y <strong>Prettier</strong> configurados</li>
<li><strong>Comentarios</strong> en ingl√©s</li>
<li><strong>Nombres</strong> descriptivos para funciones y variables</li>
<li><strong>Error handling</strong> en todos los endpoints</li>
</ul>
<h2 id="%F0%9F%93%9A-recursos">üìö Recursos</h2>
<ul>
<li><a href="https://supabase.com/docs">Supabase Docs</a></li>
<li><a href="https://redis.io/documentation">Redis Docs</a></li>
<li><a href="https://expressjs.com/">Express.js Docs</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">WebSocket Docs</a></li>
</ul>
<h2 id="%F0%9F%93%84-licencia">üìÑ Licencia</h2>
<p>MIT License - ver <a href="../LICENSE">LICENSE</a> para detalles.</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers.html">controllers</a></li></ul><h3>Classes</h3><ul><li><a href="DecorationController.html">DecorationController</a></li><li><a href="FishController.html">FishController</a></li><li><a href="MinigameController.html">MinigameController</a></li><li><a href="PlayerController.html">PlayerController</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Sep 11 2025 11:48:53 GMT+0100 (Hor√°rio Padr√£o da √Åfrica Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>