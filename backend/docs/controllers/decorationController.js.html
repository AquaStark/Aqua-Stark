<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: decorationController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: decorationController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { DecorationService } from '../services/decorationService.js';

/**
 * Decoration Controller
 *
 * Handles HTTP requests related to aquarium decoration operations including
 * state management, placement, positioning, visibility, and bulk operations.
 *
 * All methods follow a consistent response format:
 * - Success: { success: true, data: result, message?: string }
 * - Error: { error: string }
 *
 * @class DecorationController
 */
export class DecorationController {
  /**
   * Get decoration state
   *
   * Retrieves the current state of a specific decoration.
   * The resource is pre-validated by ownership middleware.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.resource - Pre-validated decoration resource from middleware
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with decoration state data
   *
   * @example
   * // GET /api/decorations/123/state
   * // Response: { success: true, data: { decorationId: "123", positionX: 100, ... } }
   */
  static async getDecorationState(req, res) {
    try {
      // Resource is already validated by ownership middleware
      const decorationState = req.resource;

      res.json({ success: true, data: decorationState });
    } catch (error) {
      console.error('Error in getDecorationState:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Create new decoration state
   *
   * Creates a new decoration state for a player, optionally associating it with an aquarium.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.body - Request body
   * @param {string} req.body.decorationId - Unique decoration identifier
   * @param {string} [req.body.aquariumId] - Optional aquarium ID to associate with
   * @param {Object} req.user - Authenticated user data
   * @param {string} req.user.playerId - Authenticated player's ID
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with created decoration data
   *
   * @example
   * // POST /api/decorations
   * // Body: { decorationId: "123", aquariumId: "456" }
   * // Response: { success: true, data: { ... }, message: "Decoration state created successfully" }
   */
  static async createDecorationState(req, res) {
    try {
      const { decorationId, aquariumId } = req.body;
      const { playerId } = req.user;

      if (!decorationId) {
        return res.status(400).json({ error: 'Decoration ID is required' });
      }

      const newDecoration = await DecorationService.createDecorationState(
        decorationId,
        playerId,
        aquariumId
      );

      res.status(201).json({
        success: true,
        data: newDecoration,
        message: 'Decoration state created successfully',
      });
    } catch (error) {
      console.error('Error in createDecorationState:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Get all decorations for a player
   *
   * Retrieves all decorations belonging to a specific player.
   * Players can only access their own decorations.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.playerId - Player ID from URL
   * @param {Object} req.user - Authenticated user data
   * @param {string} req.user.playerId - Authenticated player's ID
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with array of player's decorations
   *
   * @example
   * // GET /api/players/123/decorations
   * // Response: { success: true, data: [{ decorationId: "456", type: "plant", ... }, ...] }
   */
  static async getPlayerDecorations(req, res) {
    try {
      const { playerId } = req.params;
      const { playerId: authenticatedPlayerId } = req.user;

      // Ensure player can only access their own decorations
      if (playerId !== authenticatedPlayerId) {
        return res.status(403).json({ error: 'Access denied' });
      }

      const decorations =
        await DecorationService.getPlayerDecorations(playerId);

      res.json({ success: true, data: decorations });
    } catch (error) {
      console.error('Error in getPlayerDecorations:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Get decorations in a specific aquarium
   *
   * Retrieves all decorations currently placed in a specific aquarium.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.aquariumId - Aquarium ID from URL
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with array of aquarium decorations
   *
   * @example
   * // GET /api/aquariums/456/decorations
   * // Response: { success: true, data: [{ decorationId: "123", positionX: 100, ... }, ...] }
   */
  static async getAquariumDecorations(req, res) {
    try {
      const { aquariumId } = req.params;

      if (!aquariumId) {
        return res.status(400).json({ error: 'Aquarium ID is required' });
      }

      const decorations =
        await DecorationService.getAquariumDecorations(aquariumId);

      res.json({ success: true, data: decorations });
    } catch (error) {
      console.error('Error in getAquariumDecorations:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Place decoration in aquarium
   *
   * Places a decoration at a specific position in an aquarium with optional rotation.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.decorationId - Decoration ID from URL
   * @param {Object} req.body - Request body
   * @param {string} req.body.aquariumId - Aquarium ID to place decoration in
   * @param {number} req.body.positionX - X coordinate position
   * @param {number} req.body.positionY - Y coordinate position
   * @param {number} [req.body.rotationDegrees=0] - Rotation angle in degrees
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with placed decoration data
   *
   * @example
   * // PUT /api/decorations/123/place
   * // Body: { aquariumId: "456", positionX: 100, positionY: 200, rotationDegrees: 45 }
   * // Response: { success: true, data: { ... }, message: "Decoration placed successfully" }
   */
  static async placeDecoration(req, res) {
    try {
      const { decorationId } = req.params;
      const {
        aquariumId,
        positionX,
        positionY,
        rotationDegrees = 0,
      } = req.body;

      if (!aquariumId || positionX === undefined || positionY === undefined) {
        return res
          .status(400)
          .json({ error: 'Aquarium ID and position are required' });
      }

      const placedDecoration = await DecorationService.placeDecoration(
        decorationId,
        aquariumId,
        positionX,
        positionY,
        rotationDegrees
      );

      res.json({
        success: true,
        data: placedDecoration,
        message: 'Decoration placed successfully',
      });
    } catch (error) {
      console.error('Error in placeDecoration:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Remove decoration from aquarium
   *
   * Removes a decoration from its current aquarium placement.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.decorationId - Decoration ID from URL
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with removed decoration data
   *
   * @example
   * // DELETE /api/decorations/123
   * // Response: { success: true, data: { ... }, message: "Decoration removed successfully" }
   */
  static async removeDecoration(req, res) {
    try {
      const { decorationId } = req.params;

      const removedDecoration =
        await DecorationService.removeDecoration(decorationId);

      res.json({
        success: true,
        data: removedDecoration,
        message: 'Decoration removed successfully',
      });
    } catch (error) {
      console.error('Error in removeDecoration:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Update decoration position
   *
   * Updates the position and rotation of a decoration within its aquarium.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.decorationId - Decoration ID from URL
   * @param {Object} req.body - Request body
   * @param {number} req.body.positionX - New X coordinate position
   * @param {number} req.body.positionY - New Y coordinate position
   * @param {number} [req.body.rotationDegrees=0] - New rotation angle in degrees
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with updated decoration data
   *
   * @example
   * // PUT /api/decorations/123/position
   * // Body: { positionX: 150, positionY: 250, rotationDegrees: 90 }
   * // Response: { success: true, data: { ... }, message: "Decoration position updated successfully" }
   */
  static async updateDecorationPosition(req, res) {
    try {
      const { decorationId } = req.params;
      const { positionX, positionY, rotationDegrees = 0 } = req.body;

      if (positionX === undefined || positionY === undefined) {
        return res
          .status(400)
          .json({ error: 'Position coordinates are required' });
      }

      const updatedDecoration =
        await DecorationService.updateDecorationPosition(
          decorationId,
          positionX,
          positionY,
          rotationDegrees
        );

      res.json({
        success: true,
        data: updatedDecoration,
        message: 'Decoration position updated successfully',
      });
    } catch (error) {
      console.error('Error in updateDecorationPosition:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Toggle decoration visibility
   *
   * Toggles the visibility state of a decoration (show/hide).
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.decorationId - Decoration ID from URL
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with updated decoration data
   *
   * @example
   * // PUT /api/decorations/123/visibility
   * // Response: { success: true, data: { ... }, message: "Decoration visibility enabled" }
   */
  static async toggleDecorationVisibility(req, res) {
    try {
      const { decorationId } = req.params;

      const updatedDecoration =
        await DecorationService.toggleDecorationVisibility(decorationId);

      res.json({
        success: true,
        data: updatedDecoration,
        message: `Decoration visibility ${updatedDecoration.is_visible ? 'enabled' : 'disabled'}`,
      });
    } catch (error) {
      console.error('Error in toggleDecorationVisibility:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Move decoration between aquariums
   *
   * Moves a decoration from one aquarium to another.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.decorationId - Decoration ID from URL
   * @param {Object} req.body - Request body
   * @param {string} req.body.fromAquariumId - Source aquarium ID
   * @param {string} req.body.toAquariumId - Destination aquarium ID
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with moved decoration data
   *
   * @example
   * // PUT /api/decorations/123/move
   * // Body: { fromAquariumId: "456", toAquariumId: "789" }
   * // Response: { success: true, data: { ... }, message: "Decoration moved successfully" }
   */
  static async moveDecoration(req, res) {
    try {
      const { decorationId } = req.params;
      const { fromAquariumId, toAquariumId } = req.body;

      if (!fromAquariumId || !toAquariumId) {
        return res
          .status(400)
          .json({ error: 'From aquarium ID and to aquarium ID are required' });
      }

      const movedDecoration = await DecorationService.moveDecoration(
        decorationId,
        fromAquariumId,
        toAquariumId
      );

      res.json({
        success: true,
        data: movedDecoration,
        message: 'Decoration moved successfully',
      });
    } catch (error) {
      console.error('Error in moveDecoration:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Get decoration statistics for a player
   *
   * Retrieves aggregated statistics about a player's decorations.
   * Players can only access their own decoration statistics.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.params - Request parameters
   * @param {string} req.params.playerId - Player ID from URL
   * @param {Object} req.user - Authenticated user data
   * @param {string} req.user.playerId - Authenticated player's ID
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with decoration statistics
   *
   * @example
   * // GET /api/players/123/decorations/stats
   * // Response: { success: true, data: { totalDecorations: 15, byType: {...}, ... } }
   */
  static async getPlayerDecorationStats(req, res) {
    try {
      const { playerId } = req.params;
      const { playerId: authenticatedPlayerId } = req.user;

      // Ensure player can only access their own decoration stats
      if (playerId !== authenticatedPlayerId) {
        return res.status(403).json({ error: 'Access denied' });
      }

      const stats = await DecorationService.getPlayerDecorationStats(playerId);

      res.json({ success: true, data: stats });
    } catch (error) {
      console.error('Error in getPlayerDecorationStats:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }

  /**
   * Bulk update decoration positions
   *
   * Updates positions for multiple decorations in a single request.
   * Useful for drag-and-drop operations. Validates ownership of all decorations.
   *
   * @static
   * @async
   * @param {Object} req - Express request object
   * @param {Object} req.body - Request body
   * @param {Array} req.body.decorations - Array of decoration updates
   * @param {string} req.body.decorations[].decorationId - Decoration ID
   * @param {number} req.body.decorations[].positionX - New X position
   * @param {number} req.body.decorations[].positionY - New Y position
   * @param {number} [req.body.decorations[].rotationDegrees=0] - New rotation
   * @param {Object} req.user - Authenticated user data
   * @param {string} req.user.playerId - Authenticated player's ID
   * @param {Object} res - Express response object
   * @returns {Promise&lt;void>} JSON response with updated decorations array
   *
   * @example
   * // PUT /api/decorations/bulk-update
   * // Body: { decorations: [
   * //   { decorationId: "123", positionX: 100, positionY: 200 },
   * //   { decorationId: "456", positionX: 150, positionY: 250, rotationDegrees: 45 }
   * // ]}
   * // Response: { success: true, data: [...], message: "2 decorations updated successfully" }
   */
  static async bulkUpdatePositions(req, res) {
    try {
      const { decorations } = req.body;
      const { playerId } = req.user;

      if (!decorations || !Array.isArray(decorations)) {
        return res.status(400).json({ error: 'Decorations array is required' });
      }

      // Validate that all decorations belong to the authenticated player
      for (const decoration of decorations) {
        const decorationState = await DecorationService.getDecorationState(
          decoration.decorationId
        );
        if (!decorationState || decorationState.player_id !== playerId) {
          return res.status(403).json({
            error: 'Access denied',
            message: `Decoration ${decoration.decorationId} does not belong to you`,
          });
        }
      }

      const updatePromises = decorations.map(decoration =>
        DecorationService.updateDecorationPosition(
          decoration.decorationId,
          decoration.positionX,
          decoration.positionY,
          decoration.rotationDegrees || 0
        )
      );

      const updatedDecorations = await Promise.all(updatePromises);

      res.json({
        success: true,
        data: updatedDecorations,
        message: `${updatedDecorations.length} decorations updated successfully`,
      });
    } catch (error) {
      console.error('Error in bulkUpdatePositions:', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers.html">controllers</a></li></ul><h3>Classes</h3><ul><li><a href="DecorationController.html">DecorationController</a></li><li><a href="FishController.html">FishController</a></li><li><a href="MinigameController.html">MinigameController</a></li><li><a href="PlayerController.html">PlayerController</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Sep 11 2025 11:48:53 GMT+0100 (Horário Padrão da África Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
